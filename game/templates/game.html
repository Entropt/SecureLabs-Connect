<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ page_title }}</title>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script type="text/javascript">
        var currUserName = "{{ curr_user_name }}";
        var launchId = "{{ launch_id }}";
    </script>
</head>

<body>
    <header>
        <h1>List of Security Challenges</h1>
    </header>

    {% if is_deep_link_launch %}
    <div class="challenge-container">
        {% if challenge_categories %}
            {% for category, challenges in challenge_categories.items() %}
                <div class="category-section">
                    <h2 class="category-title">{{ category }}</h2>
                    <div class="challenges-grid">
                        {% for challenge in challenges %}
                            <div class="challenge-card">
                                <div class="challenge-name">{{ challenge.name }}</div>
                                <div class="challenge-description">{{ challenge.description }}</div>
                                <div class="challenge-meta">
                                    <div class="difficulty">
                                        Difficulty: 
                                        <span class="difficulty-stars">
                                            {% for i in range(challenge.difficulty or 0) %}★{% endfor %}{% for i in range(6 - (challenge.difficulty or 0)) %}☆{% endfor %}
                                        </span>
                                    </div>
                                </div>
                                <a href="{{ url_for('configure', launch_id=launch_id, challenge_id=challenge.id) }}" class="select-button">
                                    Select Challenge
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="category-section">
                <p>Unable to load challenges. Please try again later.</p>
            </div>
        {% endif %}
    </div>
    {% else %}
    <div class="challenge-container">
        <div class="category-section">
            <h2 class="category-title">Redirecting to Security Challenges...</h2>
            <p>You will be redirected to the Juice Shop security challenges platform.</p>
            <script>
                // Automatically redirect to Juice Shop
                window.location.href = "http://172.22.183.134:3000/#/challenge";
            </script>
        </div>
    </div>
    {% endif %}
</body>

</html>